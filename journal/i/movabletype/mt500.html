<?php echo '<?xml version="1.0" encoding="UTF-8"?>' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>MTで500エラーが出てるのに対応中｜linker journal</title>
<link rel="stylesheet" href="http://linker.in/journal/i/css/style.css" type="text/css" />
<meta name="viewport" content="width=480, user-scalable=no, maximum-scale=0.6667" />
<meta name="robots" content="noindex" />
</head>

<body>
<p id="logo"><a href="http://linker.in/journal/i/">linker journal</a></p>

<div id="content">

<p><a href="http://linker.in/journal/i/"><img src="http://linker.in/journal/i/img/totop.png" width="136" height="33" alt="トップページへ" /></a></p>

<h1>MTで500エラーが出てるのに対応中</h1>

<p id="topicpath">linker journal&nbsp;&raquo;&nbsp;Movable Type&nbsp;&raquo;&nbsp;MTで500エラーが出てるのに対応中</p>

<p>みなさん、こんにちは、まーしーです<br />
昨日の日食みました？家の周りは雲々で全然みれずでした・・・</p>
<p>少し前からここで使用しているMTが頻繁に500エラーをかえすもんで、どうしたものかと色々原因を調べているところでした。<br />
コメントの投稿などでエラーが出てた方がいたら本当に申し訳ありません。<br />
現時点で完全に解決したわけではないのでまだ様子見なのですが、とおもったのでとりあえず現時点での事をメモしておきます。<br />
同じような悩みを抱えてる方の参考になったらさいわいで素。</p>
<p>わかる方から見たら「間抜けな事を」と思われてしまうかもですが、間違ってるとかあったら教えてもらえると嬉しいです。</p>
<h2>今までの症状</h2>
<ul>
  <li>ブログ記事を投稿する際に500エラーが返ってくる</li>

  <li>コメントを投稿する際にもエラーがでてるっぽい</li>

  <li>更新pingのエラー</li>
</ul>
<p>普段も仕事でMTを使うことはあるのですが、その時と特段違う作り方をしているわけでもなく、 上記のエラーも毎回とは限らないのでなかなか見極めが出来ていない状況です。</p>
<p>ちなみに、現在linkerのMTが動いてるサーバーはwadaxです。</p>
<h2>原因と考えられることとか</h2>
<p>原因とは断定できないですが、エラーが出始めた頃にしたこととかは</p>
<ul>
  <li>タグが増えすぎて、mt-search.cgiが高負荷</li>

  <li>サーバーが耐えられない</li>

  <li>更新pingの送信先を増やした</li>

  <li>MT4iをいれた</li>

  <li>再構築させるテンプレートを改めて見直す</li>
</ul>
<p>あたりです。</p>
<h2>対応策</h2>
<h3>タグが増えすぎて、mt-search.cgiが高負荷</h3>
<p>タグの整理は今後の課題ですね。</p>
<p><a href="https://www.google.com/webmasters/tools/">webmasterツール</a>を参考にしてrobots.txtをかいてみてクローラの対応を少し調整してみました。</p>
<pre class="brush:xml">
User-Agent: *
Allow: /
Disallow: /MTインストールフォルダ/
</pre>
<p>なんか結果が出たのかどうなのかいまいちなかんじなのでした。書き方がそもそも間違ってたのかもしれないのですが。</p>
<p>プラグインを入れてなにかしら解決ができないか考えないといけないのかも、と思っているところです。</p>
<blockquote>
  <p>MovableTypeの検索機能を爆速にするプラグイン：SearchResultsCache - Open MagicVox.net<br />
  <a href="http://www.magicvox.net/archive/2008/03082243/">http://www.magicvox.net/archive/2008/03082243/</a><br />
  MovableType でタグ検索 URL をスマートにする - Open MagicVox.net<br />
  <a href="http://www.magicvox.net/archive/2009/03281633/">http://www.magicvox.net/archive/2009/03281633/</a></p>
</blockquote>
<p>この辺のプラグインはすごそうです。</p>
<h3>更新pingの送信先を増やした<br /></h3>
<p>
更新pingが多すぎる？とかおもいながら減らしてみたりしましたが特に変わらずでした。<br />ゼロにしたところで変わらないので、ここは原因じゃないんだろう、ととりあえず判断。<br />そもそもpingがうまく送信できていないのは送信先を間違ってるとか別な所に問題があるんだろう、ということでMTの標準だけ設定。
</p>
<h3>MT4iをいれた</h3>
<blockquote>
  <p>linker journalにMT4iをいれてみました｜linker journal｜linker<br />
  <a href="http://linker.in/journal/2009/06/linker-journalmt4i.php">http://linker.in/journal/2009/06/linker-journalmt4i.php</a></p>
</blockquote>
<p>
でも書いたのですが、MT4iの可能性もあるのかも？とおもったので、とりあえずMT4iを一度外してみました。
</p>
<h3>サーバーが耐えられない</h3>
<p>
色々ググってみると古い情報からいくつかあったのですが。
</p>
<blockquote>
  <p>WADAX 共用サーバ Error 500 Internal Server Error について - 湘南画材研究所@MT<br />
  <a href="http://tomono10g.net/blog/2009/01/wadax-error-500-internal-server-error.html">http://tomono10g.net/blog/2009/01/wadax-error-500-internal-server-error.html</a></p>

  <p>メモ：@NextStyle（WADAX）にMT4.23をインストールする - notebook<br />
  <a href="http://soulsociety.ne.jp/notebook/2009/02/nextstylewadaxmt423.html">http://soulsociety.ne.jp/notebook/2009/02/nextstylewadaxmt423.html</a></p>

  <p>@NextStyle（WADAX）にMT4.2.2をインストールする ｜ ZIYOTOY.NET【じよとい】<br />
  <a href="http://www.ziyotoy.net/2008/10/wadaxmt4.html">http://www.ziyotoy.net/2008/10/wadaxmt4.html</a></p>

  <p>Touch and Go &gt; 2008年12月 : ITmedia オルタナティブ・ブログ<br />
  <a href="http://blogs.itmedia.co.jp/touch_and_go/2008/12/index.html">http://blogs.itmedia.co.jp/touch_and_go/2008/12/index.html</a>&nbsp;&nbsp;</p>
</blockquote>
<p>
電話で問い合わせた際もCGI実行時間の話をしたような気がして断られたと思ってたのですが、@cremaにも教えてもらった
</p>
<blockquote>
  <p>レンタルサーバーのWADAX　 ＠Next Style<br />
  <a href="http://faq.wadax.ne.jp/wdx5569/web3765/faq/print.asp?FAQID=670&amp;baID=22&amp;strKind=2&amp;Option=&amp;NodeID=&amp;DispNodeID=&amp;CID=&amp;Text=&amp;Field=&amp;KW=&amp;KWAnd=&amp;Attrs=&amp;SearchID=">http://faq.wadax.ne.jp/wdx5569/web3765/faq/print.asp?FAQID=670&amp;baID=22&amp;strKind=2&amp;Option=&amp;NodeID=&amp;DispNodeID=&amp;CID=&amp;Text=&amp;Field=&amp;KW=&amp;KWAnd=&amp;Attrs=&amp;SearchID=</a></p>
</blockquote>
<p>
を参考にしてメールしたら、即日実行時間を延ばしてくれました。
</p>
<h3>再構築するテンプレートを改めて見直す</h3>
<p>
ブログ記事を投稿した際にブログ記事・アーカイブ・インデックスは再構築しますが、テンプレートによっては再構築不要なモノもあるのでその辺を変更。<br />mt.jsやgoogleのカスタム検索用のテンプレートです。
</p>
<h2>現時点での症状</h2>
<p>
ちょうどこんな記事もでてましたので、参考にしていくつか修正してみました。
</p>
<blockquote>
  <p>Six Apart - Movable Type アップグレード 秘話ブログ - :GIZMODO JAPAN編 - :第三話　MT4高速化しよう！講座の巻<br />
  <a href="http://www.sixapart.jp/promotions/upgrade/gizmodomovable_type_03.html">http://www.sixapart.jp/promotions/upgrade/gizmodomovable_type_03.html</a></p>
</blockquote>
<p>
mt:Includeが重いとかいわれるとどうしたものかな、というところなのですがそのあたりは調べておかないといけないですね。
</p>
<p>
既存の記事を再度保存してみたり、コメントしたかんじではエラーは出てない感じです。<br />とはいえ、まだ元の状態には戻っていないので色々きりわけていかないとなぁ、と考えています。 <br /> 再構築といえばjunnamaさんですかね。今度色々聞いてみたいです。
</p>
<p>
ほんと勉強不足以外の何物でもないです。@crema,@taku-workには迷惑かけまくりです。スンマセン。<br />MTを担当させてもらってるのにこんなんでほんと申し訳ない限りです。
</p>
<p>
コメント残そうとしたらエラーで残せなかった、とかいう方もいらしたら本当にスミマセン。 
</p>




<p class="previousEntry"><a href="http://linker.in/journal/i/other/post_37.php">&laquo;&nbsp;前の記事へ</a></p>
<p class="nextEntry"><a href="http://linker.in/journal/i/other/meeting.php">次の記事へ&nbsp;&raquo;</a></p>

<p class="totop"><a href="http://linker.in/journal/i/"><img src="http://linker.in/journal/i/img/totop.png" width="136" height="33" alt="トップページへ" /></a></p>

<!-- end div#content --></div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6930174-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>

